# Magnetar-PLUTO-files
This repository provides files for modeling magnetar structure in PLUTO, an astrophysical dynamics software package.

This fork is associated with our paper Modeling Magnetohydrodynamic Equilibrium in Magnetars with Applications to Continuous Gravitational Wave Production at https://arxiv.org/abs/2002.02619.

[![DOI](https://zenodo.org/badge/298370663.svg)](https://zenodo.org/badge/latestdoi/298370663)


## Archived Repository Version 1.0.1
[![DOI](https://zenodo.org/badge/146366066.svg)](https://zenodo.org/badge/latestdoi/146366066)

## File Structure

* __Documents and .Tex files__ - Documents detailing boundary conditions and state equations for neutron star simulations
* __Magnetar_Main__ - Includes the principle files for simulating magnetar structure in PLUTO
* __Object files__ - Object files generated by during compiling of simulation code
* __Place_in_PLUTO_Src_dir__ - Modified source code for PLUTO that must be added to `path_to_PLUTO_directory/Src`
* __Python files__ - Basic scripts for assisting research in plotting stucture of gravitational potential and b-field. Also includes script *Condition_Grid_Analysis.py* for analyzing whether radial points in the computational domain will be will-behaved with respect to relative condition numbers for b-field component equations.
* __VisIt Config Files__ - Contains .xml files for configuring vector plots and streamline attributes. Additionally, *"Vector_Correction_Expressions.xml"* contains expressions which convert vector-valued variables in spherical coordinates to cartesian coordinates. These files can be imported directly into a user's VisIt directory.

## Dependencies
In order to utilize these files, the following packages must be installed:
 * PLUTO v4.40. *The following are required to properly utilize PLUTO:*
   * Python
   * C Compiler
   * GNU Make
* Visualiztion software utility: Numerous options are compatable with PLUTO including Gnuplot, IDL, pyPLUTO, Mathematica, Paraview, or VisIt.

The code provided in this repository is largely written in C, with the exception of a few python scripts written in 2.7 under the folder "Python Files".

## Installation Procedure

### 1. PLUTO

The PLUTO Code must be downloaded from the following link: http://plutocode.ph.unito.it/download.html.

Download and extract the file to your home directory. It is recommended to create the enivronment variable "PLUTO_DIR" so that the user can quickly access the PLUTO directory. In bash, this is accomplished by adding the variable to the user's .bashrc file via the command:
```console
user@computer:~$ export PLUTO_DIR=/path/to/PLUTO
```

The python script "setup.py" included with PLUTO can be used to quickly configure simulation parameters. Settings are modified by arrow keys and selected using "Enter".

To verify proper installation of PLUTO, it is recommended that the user run one of the various test problems included with the PLUTO base by navigating to:
```console
user@computer:~$ cd $PLUTO_DIR/Test_Problems
```
More information including step-by-step guides to test problems is included in the PLUTO User Manual, available via:
http://plutocode.ph.unito.it/files/userguide.pdf (See pages 6-9 for test problems)

*<ins>Important!</ins>*
In order run properly run magnetar simulations, files in the Place_in_PLUTO_Src_dir folder __must__ be copied to the PLUTO source code directory (something like `path_to_PLUTO_directory/Src`).

### 2. VisIt
Although a varity of visualization software packages are compatable with PLUTO, this work has implemented VisIt v3.1.4, for which we provide detailed installation instructions.

Visit may be downloaded from the following link: https://wci.llnl.gov/simulation/computer-codes/visit/executables

Installation for Windows and Mac is fairly straightforward, as .exe and .dmg installer programs are provided for the respective operating system.

#### Installing VisIt on Unix-based Systems
* Run the VisIt install script. The script for v3.1.4 is available at the following link: https://github.com/visit-dav/visit/releases/download/v3.1.4/visit-install3_1_4

* Add a bin directory after the location of the installed directory, i.e ( /user/local/visit/bin ). This directory will contain the script responsible for launching VisIt. This may be accomplished by adding it to the users .bashrc folder:
```console
user@computer:~$ export path=/usr/local/visit/bin
```
*More details regarding VisIt installation is available at the following link:* https://github.com/visit-dav/visit/releases/download/v3.1.4/INSTALL_NOTES.txt

*It is recommended for systems with NVidia graphics cards to update to the latest drivers. Failure to do so may result in frequent program crashes.*

### 3. Repository Files
Files downloaded from this repository may be unzipped directly into one's PLUTO directory. Alternatively, one may prefer to use a "Working PLUTO directory" to delineate user-added simulations from default programs.

## Running Magnetar Simulations
This repository details simulation of highly magnetic pulsars via the PLUTO code. This is primarily accomplished by building both a structural stellar model and magnetic field model. These simulation components are contained within the following files:

#### These files are included in the folder *"Magnetar_Main"*
The following files provide the core of each PLUTO simulation:
* *definitions.h*
* *init.c*
* *makefile*
* *pluto.ini*



*Additional in-depth information regarding the function and manipulation of each of these scripts is available via the PLUTO User Manual*

### *definitions.h*
A header file specifying parameters for a given simulation. Most of these values can be specified via *setup.py*, however, the user may specify additional simulation constraints which are detailed further in the PLUTO User Manual.
* The *definitions.h* file particular to these magnetar simulations uses PLUTO's magnetohydrodyanmic (MHD) module and specifies a 3-dimensional spherical computational domain.  

### *init.c*
The init.c file collects most of the user-supplied functions useful for problem configuration.
* The *init.c* file particular to these simulations provide initialization for simulation variables, such as velocity, pressure, density, magnetic field components, etc.
* Boundary Conditions are specified in the UserDefBoundary() function.
* Gravitational Potential is assigned via the BodyForcePotential() function.

### *Makefile*
In order to compile modifications to the code, the user must run the following command
```console
user@computer:~/PLUTO/Magnetar_Main$ make
```
### *pluto.ini*
An initialization file which sets simulation attributes. Upon execution of the PLUTO Code via the command
```console
user@computer:~/PLUTO/Magnetar_Main$ ./pluto
```
the code reads this initialization file to determine the specified simulation parameters. This begins the process of computation.
* The *pluto.ini* file particular to these simulations specifies a spherical domain: radially (0<r<=2.0) in normalized units of stellar radius, (0 < theta < pi), and ( 0 < phi < 2pi) where we use the physics convention specifying phi as the azimuthal angle.

## Data Visualization with VisIt
The *pluto.ini* file particular to these simulations implements .vtk data files for writing simulation variables. This distinction can be changed in *pluto.ini*. Variables are either written as scalar values or vector-valued variables. Data are visualized by loading datasets into VisIt. Detailed information for use of VisIt is available via the VisIt User Manual: https://visit-sphinx-user-manual.readthedocs.io/en/latest/

### Vector Coordinate Conversions
As data are imported into VisIt, the software assigns variables to gridpoints in cartesian coordinates. __*As an important distinction, this conflicts with how we specify vector-valued functions in our init.c via a spherical coordinate system.*__ Thus, in order to properly visualize vector-valued variables such as velocity and magnetic fields, we must convert vector components from spherical to cartesian coordinates.
* These coordinate transformations are described in the folder *"VisIt Config Files"* under the *"Vector_Correction_Expressions.xml"* file. The supplementing file *"Visit_Spherical_to_Cartesian_Conversion.txt"* provides additional background to this transformation process.
